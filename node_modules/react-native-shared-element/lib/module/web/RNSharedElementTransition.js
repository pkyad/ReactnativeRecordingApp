import _classCallCheck from"@babel/runtime/helpers/classCallCheck";import _createClass from"@babel/runtime/helpers/createClass";import{RNSharedElementTransitionItem}from'./RNSharedElementTransitionItem';import{RNSharedElementNodeManager}from'./RNSharedElementNodeManager';import{RNSharedElementAnimation,RNSharedElementResize,RNSharedElementAlign}from'./types';import{Rect}from'./Rect';import{RNSharedElementStyle}from'./RNSharedElementStyle';import{RNSharedElementContent}from'./RNSharedElementContent';import{RNSharedElementView}from'./RNSharedElementView';export var RNSharedElementTransition=function(){function RNSharedElementTransition(){_classCallCheck(this,RNSharedElementTransition);this.items=[new RNSharedElementTransitionItem(RNSharedElementNodeManager.getInstance(),'start'),new RNSharedElementTransitionItem(RNSharedElementNodeManager.getInstance(),'end')];this.animation=RNSharedElementAnimation.Move;this.resize=RNSharedElementResize.Auto;this.align=RNSharedElementAlign.Auto;this.nodePosition=0;this.element=null;this.layout=Rect.empty;this.views=[null,null];}_createClass(RNSharedElementTransition,[{key:"destroy",value:function destroy(){this.element=null;this.items.forEach(function(item){return item.node=null;});}},{key:"setNode",value:function setNode(end,node,ancestor){this.items[end?1:0].node=node&&ancestor?RNSharedElementNodeManager.getInstance().acquire(node.nodeHandle,node.isParent,ancestor.nodeHandle):null;}},{key:"didSetProps",value:function didSetProps(){this.requestStylesAndContent();this.updateLayout();this.updateNodeVisibility();}},{key:"requestStylesAndContent",value:function requestStylesAndContent(){var _this=this;this.items.forEach(function(item){if(item.needsStyle){item.needsStyle=false;item.node.requestStyle().then(function(style){item.style=style;_this.updateLayout();});}if(item.needsContent){item.needsContent=false;item.node.requestContent().then(function(content){item.content=content;_this.updateLayout();});}});}},{key:"updateNodeVisibility",value:function updateNodeVisibility(){var items=this.items,animation=this.animation;items.forEach(function(item){var hidden=item.style&&item.content?true:false;if(hidden&&animation===RNSharedElementAnimation.FadeIn&&item.name==='start')hidden=false;if(hidden&&animation===RNSharedElementAnimation.FadeOut&&item.name==='end')hidden=false;item.hidden=hidden;});}},{key:"updateLayout",value:function updateLayout(){var element=this.element,items=this.items,nodePosition=this.nodePosition,animation=this.animation;if(!element)return;this.layout=new Rect(element.getBoundingClientRect());var startStyle=items[0].style;var endStyle=items[1].style;if(!startStyle&&!endStyle)return;var startContent=items[0].content;var endContent=items[1].content;var startLayout=startStyle?startStyle.layout:Rect.empty;var startContentLayout=startStyle?RNSharedElementContent.getLayout(startLayout,startContent,startStyle.style.backgroundSize):startLayout;var endLayout=endStyle?endStyle.layout:Rect.empty;var endContentLayout=endStyle?RNSharedElementContent.getLayout(endLayout,endContent||startContent,endStyle.style.backgroundSize):endLayout;var interpolatedLayout=startLayout;var interpolatedStyle=startStyle;var interpolatedContentLayout=startContentLayout;if(startStyle&&endStyle){interpolatedLayout=RNSharedElementStyle.getInterpolatedLayout(startLayout,endLayout,nodePosition);interpolatedStyle=RNSharedElementStyle.getInterpolatedStyle(startStyle,endStyle,nodePosition);interpolatedContentLayout=RNSharedElementStyle.getInterpolatedLayout(startContentLayout,endContentLayout,nodePosition);}else if(startStyle){interpolatedLayout=startLayout;interpolatedStyle=startStyle;interpolatedContentLayout=startContentLayout;}else{interpolatedLayout=endLayout;interpolatedStyle=endStyle;interpolatedContentLayout=endContentLayout;}if(animation===RNSharedElementAnimation.Move||animation===RNSharedElementAnimation.Fade||animation===RNSharedElementAnimation.FadeOut){var startOpacity=animation===RNSharedElementAnimation.Move?interpolatedStyle.opacity:(startStyle?startStyle.opacity:1)*(1-nodePosition);this.updateView(0,interpolatedLayout,interpolatedStyle,interpolatedContentLayout,startLayout,startContent,startOpacity);}if(animation===RNSharedElementAnimation.Fade||animation===RNSharedElementAnimation.FadeIn){var endOpacity=(endStyle?endStyle.opacity:1)*nodePosition;this.updateView(1,interpolatedLayout,interpolatedStyle,interpolatedContentLayout,endLayout,endContent,endOpacity);}}},{key:"updateView",value:function updateView(index,interpolatedLayout,interpolatedStyle,interpolatedContentLayout,originalLayout,content,opacity){var view=this.views[index];if(!view){view=new RNSharedElementView();this.element.appendChild(view.element);this.views[index]=view;}view.resize=this.resize;view.align=this.align;view.parentLayout=this.layout;view.originalLayout=originalLayout;view.layout=interpolatedLayout;view.contentLayout=interpolatedContentLayout;view.style=interpolatedStyle;if(!view.contentElement){if(!content||!content.element)return;view.contentElement=content.element.cloneNode(true);}view.contentElement.style.opacity=opacity;view.updateLayout();}}]);return RNSharedElementTransition;}();
//# sourceMappingURL=RNSharedElementTransition.js.map