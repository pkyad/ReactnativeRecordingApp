{"version":3,"sources":["RNSharedElementTransition.ts"],"names":["RNSharedElementTransitionItem","RNSharedElementNodeManager","RNSharedElementAnimation","RNSharedElementResize","RNSharedElementAlign","Rect","RNSharedElementStyle","RNSharedElementContent","RNSharedElementView","RNSharedElementTransition","items","getInstance","animation","Move","resize","Auto","align","nodePosition","element","layout","empty","views","forEach","item","node","end","ancestor","acquire","nodeHandle","isParent","requestStylesAndContent","updateLayout","updateNodeVisibility","needsStyle","requestStyle","then","style","needsContent","requestContent","content","hidden","FadeIn","name","FadeOut","getBoundingClientRect","startStyle","endStyle","startContent","endContent","startLayout","startContentLayout","getLayout","backgroundSize","endLayout","endContentLayout","interpolatedLayout","interpolatedStyle","interpolatedContentLayout","getInterpolatedLayout","getInterpolatedStyle","Fade","startOpacity","opacity","updateView","endOpacity","index","originalLayout","view","appendChild","parentLayout","contentLayout","contentElement","cloneNode"],"mappings":"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","sourcesContent":["import { RNSharedElementTransitionItem } from './RNSharedElementTransitionItem';\n// import { RNSharedElementNode } from \"./RNSharedElementNode\";\nimport { RNSharedElementNodeManager } from './RNSharedElementNodeManager';\nimport {\n  RNSharedElementNodeConfig,\n  RNSharedElementAnimation,\n  RNSharedElementResize,\n  RNSharedElementAlign,\n  IHTMLElement,\n} from './types';\nimport { Rect } from './Rect';\nimport { RNSharedElementStyle } from './RNSharedElementStyle';\nimport { RNSharedElementContent } from './RNSharedElementContent';\nimport { RNSharedElementView } from './RNSharedElementView';\n\nexport class RNSharedElementTransition {\n  private items = [\n    new RNSharedElementTransitionItem(\n      RNSharedElementNodeManager.getInstance(),\n      'start'\n    ),\n    new RNSharedElementTransitionItem(\n      RNSharedElementNodeManager.getInstance(),\n      'end'\n    ),\n  ];\n  public animation: RNSharedElementAnimation = RNSharedElementAnimation.Move;\n  public resize: RNSharedElementResize = RNSharedElementResize.Auto;\n  public align: RNSharedElementAlign = RNSharedElementAlign.Auto;\n  public nodePosition: number = 0;\n  public element: IHTMLElement | null = null;\n  private layout: Rect = Rect.empty;\n  private views: (RNSharedElementView | null)[] = [null, null];\n\n  public destroy() {\n    this.element = null;\n    this.items.forEach(item => (item.node = null));\n  }\n\n  public setNode(\n    end: boolean,\n    node: RNSharedElementNodeConfig | null,\n    ancestor: RNSharedElementNodeConfig | null\n  ) {\n    this.items[end ? 1 : 0].node =\n      node && ancestor\n        ? RNSharedElementNodeManager.getInstance().acquire(\n            node.nodeHandle,\n            node.isParent,\n            ancestor.nodeHandle\n          )\n        : null;\n  }\n\n  public didSetProps() {\n    this.requestStylesAndContent();\n    this.updateLayout();\n    this.updateNodeVisibility();\n  }\n\n  private requestStylesAndContent() {\n    this.items.forEach(item => {\n      if (item.needsStyle) {\n        item.needsStyle = false;\n        item.node!.requestStyle().then(style => {\n          item.style = style;\n          this.updateLayout();\n        });\n      }\n      if (item.needsContent) {\n        item.needsContent = false;\n        item.node!.requestContent().then(content => {\n          item.content = content;\n          this.updateLayout();\n        });\n      }\n    });\n  }\n\n  private updateNodeVisibility() {\n    const { items, animation } = this;\n    items.forEach(item => {\n      let hidden = item.style && item.content ? true : false;\n      if (\n        hidden &&\n        animation === RNSharedElementAnimation.FadeIn &&\n        item.name === 'start'\n      )\n        hidden = false;\n      if (\n        hidden &&\n        animation === RNSharedElementAnimation.FadeOut &&\n        item.name === 'end'\n      )\n        hidden = false;\n      item.hidden = hidden;\n    });\n  }\n\n  private updateLayout() {\n    const {\n      element,\n      items,\n      nodePosition,\n      animation /*, animation, resize, align*/,\n    } = this;\n    if (!element) return;\n\n    // Get parent layout\n    this.layout = new Rect(element.getBoundingClientRect());\n\n    // Get styles & content\n    const startStyle = items[0].style;\n    const endStyle = items[1].style;\n    if (!startStyle && !endStyle) return;\n    const startContent = items[0].content;\n    const endContent = items[1].content;\n\n    // Get start layout\n    const startLayout = startStyle ? startStyle.layout : Rect.empty;\n    const startContentLayout = startStyle\n      ? RNSharedElementContent.getLayout(\n          startLayout,\n          startContent,\n          startStyle.style.backgroundSize\n        )\n      : startLayout;\n    //CGRect startVisibleLayout = startStyle ? [self normalizeLayout:[startItem visibleLayoutForAncestor:startAncestor] ancestor:startAncestor] : CGRectZero;\n    //UIEdgeInsets startClipInsets = [self getClipInsets:startLayout visibleLayout:startVisibleLayout];\n\n    // Get end layout\n    const endLayout = endStyle ? endStyle.layout : Rect.empty;\n    const endContentLayout = endStyle\n      ? RNSharedElementContent.getLayout(\n          endLayout,\n          endContent || startContent,\n          endStyle.style.backgroundSize\n        )\n      : endLayout;\n\n    // Get interpolated layout\n    let interpolatedLayout: Rect = startLayout;\n    let interpolatedStyle: RNSharedElementStyle = startStyle!;\n    let interpolatedContentLayout: Rect = startContentLayout;\n    // let interpolatedClipInsets: Rect = Rect.empty;\n    if (startStyle && endStyle) {\n      interpolatedLayout = RNSharedElementStyle.getInterpolatedLayout(\n        startLayout,\n        endLayout,\n        nodePosition\n      );\n      // interpolatedClipInsets = getInterpolatedClipInsets(parentLayout, startClipInsets, startClippedLayout, endClipInsets, endClippedLayout, mNodePosition);\n      interpolatedStyle = RNSharedElementStyle.getInterpolatedStyle(\n        startStyle,\n        endStyle,\n        nodePosition\n      );\n      interpolatedContentLayout = RNSharedElementStyle.getInterpolatedLayout(\n        startContentLayout,\n        endContentLayout,\n        nodePosition\n      );\n    } else if (startStyle) {\n      interpolatedLayout = startLayout;\n      interpolatedStyle = startStyle;\n      interpolatedContentLayout = startContentLayout;\n      // interpolatedClipInsets = startClipInsets;\n    } else {\n      interpolatedLayout = endLayout;\n      interpolatedStyle = endStyle!;\n      interpolatedContentLayout = endContentLayout;\n      // interpolatedClipInsets = endClipInsets;\n    }\n\n    if (\n      animation === RNSharedElementAnimation.Move ||\n      animation === RNSharedElementAnimation.Fade ||\n      animation === RNSharedElementAnimation.FadeOut\n    ) {\n      const startOpacity =\n        animation === RNSharedElementAnimation.Move\n          ? interpolatedStyle.opacity\n          : (startStyle ? startStyle.opacity : 1) * (1 - nodePosition);\n      this.updateView(\n        0,\n        interpolatedLayout,\n        interpolatedStyle,\n        interpolatedContentLayout,\n        startLayout,\n        startContent,\n        startOpacity\n      );\n    }\n    if (\n      animation === RNSharedElementAnimation.Fade ||\n      animation === RNSharedElementAnimation.FadeIn\n    ) {\n      const endOpacity = (endStyle ? endStyle.opacity : 1) * nodePosition;\n      this.updateView(\n        1,\n        interpolatedLayout,\n        interpolatedStyle,\n        interpolatedContentLayout,\n        endLayout,\n        endContent,\n        endOpacity\n      );\n    }\n  }\n\n  private updateView(\n    index: number,\n    interpolatedLayout: Rect,\n    interpolatedStyle: RNSharedElementStyle,\n    interpolatedContentLayout: Rect,\n    originalLayout: Rect,\n    content: RNSharedElementContent | null,\n    opacity: number\n  ) {\n    // Find / create view\n    let view = this.views[index];\n    if (!view) {\n      view = new RNSharedElementView();\n      this.element!.appendChild(view.element);\n      this.views[index] = view;\n    }\n\n    // Set resize & align\n    view.resize = this.resize;\n    view.align = this.align;\n\n    // Set layouts\n    view.parentLayout = this.layout;\n    view.originalLayout = originalLayout;\n    view.layout = interpolatedLayout;\n    view.contentLayout = interpolatedContentLayout;\n\n    // Set style\n    view.style = interpolatedStyle;\n\n    // If the content-element does not yet exist, then clone it and add it to the view\n    if (!view.contentElement) {\n      if (!content || !content.element) return;\n      view.contentElement = content.element.cloneNode(true);\n    }\n    view.contentElement!.style.opacity = opacity;\n\n    // Update layout\n    view.updateLayout();\n  }\n}\n"]}