{"version":3,"sources":["RNSharedElementTransition.ts"],"names":["RNSharedElementTransition","items","RNSharedElementTransitionItem","RNSharedElementNodeManager","getInstance","animation","RNSharedElementAnimation","Move","resize","RNSharedElementResize","Auto","align","RNSharedElementAlign","nodePosition","element","layout","Rect","empty","views","forEach","item","node","end","ancestor","acquire","nodeHandle","isParent","requestStylesAndContent","updateLayout","updateNodeVisibility","needsStyle","requestStyle","then","style","needsContent","requestContent","content","hidden","FadeIn","name","FadeOut","getBoundingClientRect","startStyle","endStyle","startContent","endContent","startLayout","startContentLayout","RNSharedElementContent","getLayout","backgroundSize","endLayout","endContentLayout","interpolatedLayout","interpolatedStyle","interpolatedContentLayout","RNSharedElementStyle","getInterpolatedLayout","getInterpolatedStyle","Fade","startOpacity","opacity","updateView","endOpacity","index","originalLayout","view","RNSharedElementView","appendChild","parentLayout","contentLayout","contentElement","cloneNode"],"mappings":"2WAAA,8EAEA,wEACA,8BAOA,4BACA,4DACA,gEACA,0D,GAEaA,CAAAA,yB,mHACHC,K,CAAQ,CACd,GAAIC,6DAAJ,CACEC,uDAA2BC,WAA3B,EADF,CAEE,OAFF,CADc,CAKd,GAAIF,6DAAJ,CACEC,uDAA2BC,WAA3B,EADF,CAEE,KAFF,CALc,C,MAUTC,S,CAAsCC,gCAAyBC,I,MAC/DC,M,CAAgCC,6BAAsBC,I,MACtDC,K,CAA8BC,4BAAqBF,I,MACnDG,Y,CAAuB,C,MACvBC,O,CAA+B,I,MAC9BC,M,CAAeC,WAAKC,K,MACpBC,K,CAAwC,CAAC,IAAD,CAAO,IAAP,C,8FAE/B,CACf,KAAKJ,OAAL,CAAe,IAAf,CACA,KAAKb,KAAL,CAAWkB,OAAX,CAAmB,SAAAC,IAAI,QAAKA,CAAAA,IAAI,CAACC,IAAL,CAAY,IAAjB,EAAvB,EACD,C,wCAGCC,G,CACAD,I,CACAE,Q,CACA,CACA,KAAKtB,KAAL,CAAWqB,GAAG,CAAG,CAAH,CAAO,CAArB,EAAwBD,IAAxB,CACEA,IAAI,EAAIE,QAAR,CACIpB,uDAA2BC,WAA3B,GAAyCoB,OAAzC,CACEH,IAAI,CAACI,UADP,CAEEJ,IAAI,CAACK,QAFP,CAGEH,QAAQ,CAACE,UAHX,CADJ,CAMI,IAPN,CAQD,C,iDAEoB,CACnB,KAAKE,uBAAL,GACA,KAAKC,YAAL,GACA,KAAKC,oBAAL,GACD,C,yEAEiC,gBAChC,KAAK5B,KAAL,CAAWkB,OAAX,CAAmB,SAAAC,IAAI,CAAI,CACzB,GAAIA,IAAI,CAACU,UAAT,CAAqB,CACnBV,IAAI,CAACU,UAAL,CAAkB,KAAlB,CACAV,IAAI,CAACC,IAAL,CAAWU,YAAX,GAA0BC,IAA1B,CAA+B,SAAAC,KAAK,CAAI,CACtCb,IAAI,CAACa,KAAL,CAAaA,KAAb,CACA,KAAI,CAACL,YAAL,GACD,CAHD,EAID,CACD,GAAIR,IAAI,CAACc,YAAT,CAAuB,CACrBd,IAAI,CAACc,YAAL,CAAoB,KAApB,CACAd,IAAI,CAACC,IAAL,CAAWc,cAAX,GAA4BH,IAA5B,CAAiC,SAAAI,OAAO,CAAI,CAC1ChB,IAAI,CAACgB,OAAL,CAAeA,OAAf,CACA,KAAI,CAACR,YAAL,GACD,CAHD,EAID,CACF,CAfD,EAgBD,C,mEAE8B,IACrB3B,CAAAA,KADqB,CACA,IADA,CACrBA,KADqB,CACdI,SADc,CACA,IADA,CACdA,SADc,CAE7BJ,KAAK,CAACkB,OAAN,CAAc,SAAAC,IAAI,CAAI,CACpB,GAAIiB,CAAAA,MAAM,CAAGjB,IAAI,CAACa,KAAL,EAAcb,IAAI,CAACgB,OAAnB,CAA6B,IAA7B,CAAoC,KAAjD,CACA,GACEC,MAAM,EACNhC,SAAS,GAAKC,gCAAyBgC,MADvC,EAEAlB,IAAI,CAACmB,IAAL,GAAc,OAHhB,CAKEF,MAAM,CAAG,KAAT,CACF,GACEA,MAAM,EACNhC,SAAS,GAAKC,gCAAyBkC,OADvC,EAEApB,IAAI,CAACmB,IAAL,GAAc,KAHhB,CAKEF,MAAM,CAAG,KAAT,CACFjB,IAAI,CAACiB,MAAL,CAAcA,MAAd,CACD,CAfD,EAgBD,C,mDAEsB,IAEnBvB,CAAAA,OAFmB,CAMjB,IANiB,CAEnBA,OAFmB,CAGnBb,KAHmB,CAMjB,IANiB,CAGnBA,KAHmB,CAInBY,YAJmB,CAMjB,IANiB,CAInBA,YAJmB,CAKnBR,SALmB,CAMjB,IANiB,CAKnBA,SALmB,CAOrB,GAAI,CAACS,OAAL,CAAc,OAGd,KAAKC,MAAL,CAAc,GAAIC,WAAJ,CAASF,OAAO,CAAC2B,qBAAR,EAAT,CAAd,CAGA,GAAMC,CAAAA,UAAU,CAAGzC,KAAK,CAAC,CAAD,CAAL,CAASgC,KAA5B,CACA,GAAMU,CAAAA,QAAQ,CAAG1C,KAAK,CAAC,CAAD,CAAL,CAASgC,KAA1B,CACA,GAAI,CAACS,UAAD,EAAe,CAACC,QAApB,CAA8B,OAC9B,GAAMC,CAAAA,YAAY,CAAG3C,KAAK,CAAC,CAAD,CAAL,CAASmC,OAA9B,CACA,GAAMS,CAAAA,UAAU,CAAG5C,KAAK,CAAC,CAAD,CAAL,CAASmC,OAA5B,CAGA,GAAMU,CAAAA,WAAW,CAAGJ,UAAU,CAAGA,UAAU,CAAC3B,MAAd,CAAuBC,WAAKC,KAA1D,CACA,GAAM8B,CAAAA,kBAAkB,CAAGL,UAAU,CACjCM,+CAAuBC,SAAvB,CACEH,WADF,CAEEF,YAFF,CAGEF,UAAU,CAACT,KAAX,CAAiBiB,cAHnB,CADiC,CAMjCJ,WANJ,CAWA,GAAMK,CAAAA,SAAS,CAAGR,QAAQ,CAAGA,QAAQ,CAAC5B,MAAZ,CAAqBC,WAAKC,KAApD,CACA,GAAMmC,CAAAA,gBAAgB,CAAGT,QAAQ,CAC7BK,+CAAuBC,SAAvB,CACEE,SADF,CAEEN,UAAU,EAAID,YAFhB,CAGED,QAAQ,CAACV,KAAT,CAAeiB,cAHjB,CAD6B,CAM7BC,SANJ,CASA,GAAIE,CAAAA,kBAAwB,CAAGP,WAA/B,CACA,GAAIQ,CAAAA,iBAAuC,CAAGZ,UAA9C,CACA,GAAIa,CAAAA,yBAA+B,CAAGR,kBAAtC,CAEA,GAAIL,UAAU,EAAIC,QAAlB,CAA4B,CAC1BU,kBAAkB,CAAGG,2CAAqBC,qBAArB,CACnBX,WADmB,CAEnBK,SAFmB,CAGnBtC,YAHmB,CAArB,CAMAyC,iBAAiB,CAAGE,2CAAqBE,oBAArB,CAClBhB,UADkB,CAElBC,QAFkB,CAGlB9B,YAHkB,CAApB,CAKA0C,yBAAyB,CAAGC,2CAAqBC,qBAArB,CAC1BV,kBAD0B,CAE1BK,gBAF0B,CAG1BvC,YAH0B,CAA5B,CAKD,CAjBD,IAiBO,IAAI6B,UAAJ,CAAgB,CACrBW,kBAAkB,CAAGP,WAArB,CACAQ,iBAAiB,CAAGZ,UAApB,CACAa,yBAAyB,CAAGR,kBAA5B,CAED,CALM,IAKA,CACLM,kBAAkB,CAAGF,SAArB,CACAG,iBAAiB,CAAGX,QAApB,CACAY,yBAAyB,CAAGH,gBAA5B,CAED,CAED,GACE/C,SAAS,GAAKC,gCAAyBC,IAAvC,EACAF,SAAS,GAAKC,gCAAyBqD,IADvC,EAEAtD,SAAS,GAAKC,gCAAyBkC,OAHzC,CAIE,CACA,GAAMoB,CAAAA,YAAY,CAChBvD,SAAS,GAAKC,gCAAyBC,IAAvC,CACI+C,iBAAiB,CAACO,OADtB,CAEI,CAACnB,UAAU,CAAGA,UAAU,CAACmB,OAAd,CAAwB,CAAnC,GAAyC,EAAIhD,YAA7C,CAHN,CAIA,KAAKiD,UAAL,CACE,CADF,CAEET,kBAFF,CAGEC,iBAHF,CAIEC,yBAJF,CAKET,WALF,CAMEF,YANF,CAOEgB,YAPF,EASD,CACD,GACEvD,SAAS,GAAKC,gCAAyBqD,IAAvC,EACAtD,SAAS,GAAKC,gCAAyBgC,MAFzC,CAGE,CACA,GAAMyB,CAAAA,UAAU,CAAG,CAACpB,QAAQ,CAAGA,QAAQ,CAACkB,OAAZ,CAAsB,CAA/B,EAAoChD,YAAvD,CACA,KAAKiD,UAAL,CACE,CADF,CAEET,kBAFF,CAGEC,iBAHF,CAIEC,yBAJF,CAKEJ,SALF,CAMEN,UANF,CAOEkB,UAPF,EASD,CACF,C,8CAGCC,K,CACAX,kB,CACAC,iB,CACAC,yB,CACAU,c,CACA7B,O,CACAyB,O,CACA,CAEA,GAAIK,CAAAA,IAAI,CAAG,KAAKhD,KAAL,CAAW8C,KAAX,CAAX,CACA,GAAI,CAACE,IAAL,CAAW,CACTA,IAAI,CAAG,GAAIC,yCAAJ,EAAP,CACA,KAAKrD,OAAL,CAAcsD,WAAd,CAA0BF,IAAI,CAACpD,OAA/B,EACA,KAAKI,KAAL,CAAW8C,KAAX,EAAoBE,IAApB,CACD,CAGDA,IAAI,CAAC1D,MAAL,CAAc,KAAKA,MAAnB,CACA0D,IAAI,CAACvD,KAAL,CAAa,KAAKA,KAAlB,CAGAuD,IAAI,CAACG,YAAL,CAAoB,KAAKtD,MAAzB,CACAmD,IAAI,CAACD,cAAL,CAAsBA,cAAtB,CACAC,IAAI,CAACnD,MAAL,CAAcsC,kBAAd,CACAa,IAAI,CAACI,aAAL,CAAqBf,yBAArB,CAGAW,IAAI,CAACjC,KAAL,CAAaqB,iBAAb,CAGA,GAAI,CAACY,IAAI,CAACK,cAAV,CAA0B,CACxB,GAAI,CAACnC,OAAD,EAAY,CAACA,OAAO,CAACtB,OAAzB,CAAkC,OAClCoD,IAAI,CAACK,cAAL,CAAsBnC,OAAO,CAACtB,OAAR,CAAgB0D,SAAhB,CAA0B,IAA1B,CAAtB,CACD,CACDN,IAAI,CAACK,cAAL,CAAqBtC,KAArB,CAA2B4B,OAA3B,CAAqCA,OAArC,CAGAK,IAAI,CAACtC,YAAL,GACD,C","sourcesContent":["import { RNSharedElementTransitionItem } from './RNSharedElementTransitionItem';\n// import { RNSharedElementNode } from \"./RNSharedElementNode\";\nimport { RNSharedElementNodeManager } from './RNSharedElementNodeManager';\nimport {\n  RNSharedElementNodeConfig,\n  RNSharedElementAnimation,\n  RNSharedElementResize,\n  RNSharedElementAlign,\n  IHTMLElement,\n} from './types';\nimport { Rect } from './Rect';\nimport { RNSharedElementStyle } from './RNSharedElementStyle';\nimport { RNSharedElementContent } from './RNSharedElementContent';\nimport { RNSharedElementView } from './RNSharedElementView';\n\nexport class RNSharedElementTransition {\n  private items = [\n    new RNSharedElementTransitionItem(\n      RNSharedElementNodeManager.getInstance(),\n      'start'\n    ),\n    new RNSharedElementTransitionItem(\n      RNSharedElementNodeManager.getInstance(),\n      'end'\n    ),\n  ];\n  public animation: RNSharedElementAnimation = RNSharedElementAnimation.Move;\n  public resize: RNSharedElementResize = RNSharedElementResize.Auto;\n  public align: RNSharedElementAlign = RNSharedElementAlign.Auto;\n  public nodePosition: number = 0;\n  public element: IHTMLElement | null = null;\n  private layout: Rect = Rect.empty;\n  private views: (RNSharedElementView | null)[] = [null, null];\n\n  public destroy() {\n    this.element = null;\n    this.items.forEach(item => (item.node = null));\n  }\n\n  public setNode(\n    end: boolean,\n    node: RNSharedElementNodeConfig | null,\n    ancestor: RNSharedElementNodeConfig | null\n  ) {\n    this.items[end ? 1 : 0].node =\n      node && ancestor\n        ? RNSharedElementNodeManager.getInstance().acquire(\n            node.nodeHandle,\n            node.isParent,\n            ancestor.nodeHandle\n          )\n        : null;\n  }\n\n  public didSetProps() {\n    this.requestStylesAndContent();\n    this.updateLayout();\n    this.updateNodeVisibility();\n  }\n\n  private requestStylesAndContent() {\n    this.items.forEach(item => {\n      if (item.needsStyle) {\n        item.needsStyle = false;\n        item.node!.requestStyle().then(style => {\n          item.style = style;\n          this.updateLayout();\n        });\n      }\n      if (item.needsContent) {\n        item.needsContent = false;\n        item.node!.requestContent().then(content => {\n          item.content = content;\n          this.updateLayout();\n        });\n      }\n    });\n  }\n\n  private updateNodeVisibility() {\n    const { items, animation } = this;\n    items.forEach(item => {\n      let hidden = item.style && item.content ? true : false;\n      if (\n        hidden &&\n        animation === RNSharedElementAnimation.FadeIn &&\n        item.name === 'start'\n      )\n        hidden = false;\n      if (\n        hidden &&\n        animation === RNSharedElementAnimation.FadeOut &&\n        item.name === 'end'\n      )\n        hidden = false;\n      item.hidden = hidden;\n    });\n  }\n\n  private updateLayout() {\n    const {\n      element,\n      items,\n      nodePosition,\n      animation /*, animation, resize, align*/,\n    } = this;\n    if (!element) return;\n\n    // Get parent layout\n    this.layout = new Rect(element.getBoundingClientRect());\n\n    // Get styles & content\n    const startStyle = items[0].style;\n    const endStyle = items[1].style;\n    if (!startStyle && !endStyle) return;\n    const startContent = items[0].content;\n    const endContent = items[1].content;\n\n    // Get start layout\n    const startLayout = startStyle ? startStyle.layout : Rect.empty;\n    const startContentLayout = startStyle\n      ? RNSharedElementContent.getLayout(\n          startLayout,\n          startContent,\n          startStyle.style.backgroundSize\n        )\n      : startLayout;\n    //CGRect startVisibleLayout = startStyle ? [self normalizeLayout:[startItem visibleLayoutForAncestor:startAncestor] ancestor:startAncestor] : CGRectZero;\n    //UIEdgeInsets startClipInsets = [self getClipInsets:startLayout visibleLayout:startVisibleLayout];\n\n    // Get end layout\n    const endLayout = endStyle ? endStyle.layout : Rect.empty;\n    const endContentLayout = endStyle\n      ? RNSharedElementContent.getLayout(\n          endLayout,\n          endContent || startContent,\n          endStyle.style.backgroundSize\n        )\n      : endLayout;\n\n    // Get interpolated layout\n    let interpolatedLayout: Rect = startLayout;\n    let interpolatedStyle: RNSharedElementStyle = startStyle!;\n    let interpolatedContentLayout: Rect = startContentLayout;\n    // let interpolatedClipInsets: Rect = Rect.empty;\n    if (startStyle && endStyle) {\n      interpolatedLayout = RNSharedElementStyle.getInterpolatedLayout(\n        startLayout,\n        endLayout,\n        nodePosition\n      );\n      // interpolatedClipInsets = getInterpolatedClipInsets(parentLayout, startClipInsets, startClippedLayout, endClipInsets, endClippedLayout, mNodePosition);\n      interpolatedStyle = RNSharedElementStyle.getInterpolatedStyle(\n        startStyle,\n        endStyle,\n        nodePosition\n      );\n      interpolatedContentLayout = RNSharedElementStyle.getInterpolatedLayout(\n        startContentLayout,\n        endContentLayout,\n        nodePosition\n      );\n    } else if (startStyle) {\n      interpolatedLayout = startLayout;\n      interpolatedStyle = startStyle;\n      interpolatedContentLayout = startContentLayout;\n      // interpolatedClipInsets = startClipInsets;\n    } else {\n      interpolatedLayout = endLayout;\n      interpolatedStyle = endStyle!;\n      interpolatedContentLayout = endContentLayout;\n      // interpolatedClipInsets = endClipInsets;\n    }\n\n    if (\n      animation === RNSharedElementAnimation.Move ||\n      animation === RNSharedElementAnimation.Fade ||\n      animation === RNSharedElementAnimation.FadeOut\n    ) {\n      const startOpacity =\n        animation === RNSharedElementAnimation.Move\n          ? interpolatedStyle.opacity\n          : (startStyle ? startStyle.opacity : 1) * (1 - nodePosition);\n      this.updateView(\n        0,\n        interpolatedLayout,\n        interpolatedStyle,\n        interpolatedContentLayout,\n        startLayout,\n        startContent,\n        startOpacity\n      );\n    }\n    if (\n      animation === RNSharedElementAnimation.Fade ||\n      animation === RNSharedElementAnimation.FadeIn\n    ) {\n      const endOpacity = (endStyle ? endStyle.opacity : 1) * nodePosition;\n      this.updateView(\n        1,\n        interpolatedLayout,\n        interpolatedStyle,\n        interpolatedContentLayout,\n        endLayout,\n        endContent,\n        endOpacity\n      );\n    }\n  }\n\n  private updateView(\n    index: number,\n    interpolatedLayout: Rect,\n    interpolatedStyle: RNSharedElementStyle,\n    interpolatedContentLayout: Rect,\n    originalLayout: Rect,\n    content: RNSharedElementContent | null,\n    opacity: number\n  ) {\n    // Find / create view\n    let view = this.views[index];\n    if (!view) {\n      view = new RNSharedElementView();\n      this.element!.appendChild(view.element);\n      this.views[index] = view;\n    }\n\n    // Set resize & align\n    view.resize = this.resize;\n    view.align = this.align;\n\n    // Set layouts\n    view.parentLayout = this.layout;\n    view.originalLayout = originalLayout;\n    view.layout = interpolatedLayout;\n    view.contentLayout = interpolatedContentLayout;\n\n    // Set style\n    view.style = interpolatedStyle;\n\n    // If the content-element does not yet exist, then clone it and add it to the view\n    if (!view.contentElement) {\n      if (!content || !content.element) return;\n      view.contentElement = content.element.cloneNode(true);\n    }\n    view.contentElement!.style.opacity = opacity;\n\n    // Update layout\n    view.updateLayout();\n  }\n}\n"]}