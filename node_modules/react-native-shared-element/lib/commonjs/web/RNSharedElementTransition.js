var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.RNSharedElementTransition=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _RNSharedElementTransitionItem=require("./RNSharedElementTransitionItem");var _RNSharedElementNodeManager=require("./RNSharedElementNodeManager");var _types=require("./types");var _Rect=require("./Rect");var _RNSharedElementStyle=require("./RNSharedElementStyle");var _RNSharedElementContent=require("./RNSharedElementContent");var _RNSharedElementView=require("./RNSharedElementView");var RNSharedElementTransition=function(){function RNSharedElementTransition(){(0,_classCallCheck2.default)(this,RNSharedElementTransition);this.items=[new _RNSharedElementTransitionItem.RNSharedElementTransitionItem(_RNSharedElementNodeManager.RNSharedElementNodeManager.getInstance(),'start'),new _RNSharedElementTransitionItem.RNSharedElementTransitionItem(_RNSharedElementNodeManager.RNSharedElementNodeManager.getInstance(),'end')];this.animation=_types.RNSharedElementAnimation.Move;this.resize=_types.RNSharedElementResize.Auto;this.align=_types.RNSharedElementAlign.Auto;this.nodePosition=0;this.element=null;this.layout=_Rect.Rect.empty;this.views=[null,null];}(0,_createClass2.default)(RNSharedElementTransition,[{key:"destroy",value:function destroy(){this.element=null;this.items.forEach(function(item){return item.node=null;});}},{key:"setNode",value:function setNode(end,node,ancestor){this.items[end?1:0].node=node&&ancestor?_RNSharedElementNodeManager.RNSharedElementNodeManager.getInstance().acquire(node.nodeHandle,node.isParent,ancestor.nodeHandle):null;}},{key:"didSetProps",value:function didSetProps(){this.requestStylesAndContent();this.updateLayout();this.updateNodeVisibility();}},{key:"requestStylesAndContent",value:function requestStylesAndContent(){var _this=this;this.items.forEach(function(item){if(item.needsStyle){item.needsStyle=false;item.node.requestStyle().then(function(style){item.style=style;_this.updateLayout();});}if(item.needsContent){item.needsContent=false;item.node.requestContent().then(function(content){item.content=content;_this.updateLayout();});}});}},{key:"updateNodeVisibility",value:function updateNodeVisibility(){var items=this.items,animation=this.animation;items.forEach(function(item){var hidden=item.style&&item.content?true:false;if(hidden&&animation===_types.RNSharedElementAnimation.FadeIn&&item.name==='start')hidden=false;if(hidden&&animation===_types.RNSharedElementAnimation.FadeOut&&item.name==='end')hidden=false;item.hidden=hidden;});}},{key:"updateLayout",value:function updateLayout(){var element=this.element,items=this.items,nodePosition=this.nodePosition,animation=this.animation;if(!element)return;this.layout=new _Rect.Rect(element.getBoundingClientRect());var startStyle=items[0].style;var endStyle=items[1].style;if(!startStyle&&!endStyle)return;var startContent=items[0].content;var endContent=items[1].content;var startLayout=startStyle?startStyle.layout:_Rect.Rect.empty;var startContentLayout=startStyle?_RNSharedElementContent.RNSharedElementContent.getLayout(startLayout,startContent,startStyle.style.backgroundSize):startLayout;var endLayout=endStyle?endStyle.layout:_Rect.Rect.empty;var endContentLayout=endStyle?_RNSharedElementContent.RNSharedElementContent.getLayout(endLayout,endContent||startContent,endStyle.style.backgroundSize):endLayout;var interpolatedLayout=startLayout;var interpolatedStyle=startStyle;var interpolatedContentLayout=startContentLayout;if(startStyle&&endStyle){interpolatedLayout=_RNSharedElementStyle.RNSharedElementStyle.getInterpolatedLayout(startLayout,endLayout,nodePosition);interpolatedStyle=_RNSharedElementStyle.RNSharedElementStyle.getInterpolatedStyle(startStyle,endStyle,nodePosition);interpolatedContentLayout=_RNSharedElementStyle.RNSharedElementStyle.getInterpolatedLayout(startContentLayout,endContentLayout,nodePosition);}else if(startStyle){interpolatedLayout=startLayout;interpolatedStyle=startStyle;interpolatedContentLayout=startContentLayout;}else{interpolatedLayout=endLayout;interpolatedStyle=endStyle;interpolatedContentLayout=endContentLayout;}if(animation===_types.RNSharedElementAnimation.Move||animation===_types.RNSharedElementAnimation.Fade||animation===_types.RNSharedElementAnimation.FadeOut){var startOpacity=animation===_types.RNSharedElementAnimation.Move?interpolatedStyle.opacity:(startStyle?startStyle.opacity:1)*(1-nodePosition);this.updateView(0,interpolatedLayout,interpolatedStyle,interpolatedContentLayout,startLayout,startContent,startOpacity);}if(animation===_types.RNSharedElementAnimation.Fade||animation===_types.RNSharedElementAnimation.FadeIn){var endOpacity=(endStyle?endStyle.opacity:1)*nodePosition;this.updateView(1,interpolatedLayout,interpolatedStyle,interpolatedContentLayout,endLayout,endContent,endOpacity);}}},{key:"updateView",value:function updateView(index,interpolatedLayout,interpolatedStyle,interpolatedContentLayout,originalLayout,content,opacity){var view=this.views[index];if(!view){view=new _RNSharedElementView.RNSharedElementView();this.element.appendChild(view.element);this.views[index]=view;}view.resize=this.resize;view.align=this.align;view.parentLayout=this.layout;view.originalLayout=originalLayout;view.layout=interpolatedLayout;view.contentLayout=interpolatedContentLayout;view.style=interpolatedStyle;if(!view.contentElement){if(!content||!content.element)return;view.contentElement=content.element.cloneNode(true);}view.contentElement.style.opacity=opacity;view.updateLayout();}}]);return RNSharedElementTransition;}();exports.RNSharedElementTransition=RNSharedElementTransition;
//# sourceMappingURL=RNSharedElementTransition.js.map